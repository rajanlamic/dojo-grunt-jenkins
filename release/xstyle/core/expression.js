//>>built
define("xstyle/core/expression",["xstyle/core/utils"],function(r){function m(f,d,a){return r.when(f,function(c){var e=d[0];return!c?a(e||c):e&&c.get?m(c.get(e),d.slice(1),a):c.receive?c.receive(e?function(c){m(c,d,a)}:a):e?m(c[e],d.slice(1),a):a(c)})}function v(f,d,a){m(f,d.slice(0,d.length-1),function(c){var e=d[d.length-1];c.set?c.set(e,a):c[e]=a})}var s={"true":!0,"false":!1,"null":"null","typeof":"typeof",or:"||",and:"\x26\x26"},w=1;return function(f,d,a){function c(){var a=g.length+1,c=[],b=
[],d,e,f,l=function(g){return function(n){if(!f&&(c[g]=n,a--,0>=a)){e=!0;d=p?p.apply(this,c):c[0];for(n=0;n<b.length;n++)b[n](d)}}};if(p)for(var q=0;q<g.length;q++){var k=g[q];m(k[0],k.slice(1),l(q))}else{var k=g[0],h={then:function(a){b?b.push(a):a(h)}};r.when(k[0],function(a){h=a;for(var c=1;c<k.length;c++)if(h&&h.get)h=h.get(k[c]);else{h={receive:function(b){m(a,k.slice(1),b)},put:function(b){v(a,k.slice(1),b)}};break}for(c=0;c<b.length;c++)b[c](h);b=null});return h}l(-1)();return d&&d.then?d:
{receive:function(c){b&&b.push(c);e&&c(d)},stop:function(){f=!0}}}var e=f["var-expr-"+d];if(g)return e;var g=[],t;g.id=w++;var u=[],l;a=a.join?a.join(""):a.toString();e=a.match(/^[\w_$\/\.-]*$/);a=a.replace(/("[^\"]*")|([\w_$\.\/-]+)/g,function(c,a,b){if(b){if(s.hasOwnProperty(b))return s[b];l=b.split("/");c=l.join("_").replace(/-/g,"_");u.push(c);g.push(l);a=l[0];b=f.getDefinition(a);if("string"==typeof b||b instanceof Array)b=evaluateExpression(f,a,b);else if(!b)throw Error('Could not find reference "'+
a+'"');b.forElement&&(t=!0);l[0]=b}return c});if(!e)var p=Function.apply(this,u.concat(["return ("+a+")"]));g.func=p;f["var-expr-"+d]=g;return f["var-expr-"+d]=t?{forElement:function(a){for(var d,b,e=0;e<g.length;e++){b=g[e];var f=b[0];f.forElement&&(f=b[0]=f.forElement(a,1==b.length));f=b=f.element;if(d)for(;b&&b!=d;)b=b.parentNode;b&&(d=f)}a=d["expr-result-"+g.id];a||(d["expr-result-"+g.id]=a=c(),a.element=d);return a}}:c()}});
//# sourceMappingURL=expression.js.map